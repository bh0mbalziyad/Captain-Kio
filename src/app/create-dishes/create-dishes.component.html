<mat-tab-group [selectedIndex]='selectedIndex'>
    <mat-tab label="Manage">
        <app-manage-dishes></app-manage-dishes>
    </mat-tab>
    <mat-tab label="Create">
        
        <div id='main' class="container">
            <form [formGroup]='dishForm' (ngSubmit)='submitDish()'>
                <div class="row spinner" *ngIf="isImageBeingUploaded">
                    <div class="col-sm-12">
                            <mat-progress-spinner mode='indeterminate'></mat-progress-spinner>
                    </div>
                </div>
                <div [ngClass]="{'transparent': isImageBeingUploaded}" class="row">
                    <div class="col-sm-6" style="min-height: 350px;">
                        <!-- Add image for dish -->
                        <mat-card class="previewWrapper mat-elevation-z7">
                            <mat-progress-bar *ngIf="isImageBeingUploaded" mode='indeterminate'></mat-progress-bar>
                            <img style="border-radius: 2px;" *ngIf="isImageSelected" id='previewImg' [src]="imgSrc" width="100%" height="350px" alt="dish-image">
                            <span *ngIf="!isImageSelected" class="previewText">Select an image for your dish</span>
                            <input #dishImage (change)='fileSelected($event)' type="file" style="display: none;">
                        </mat-card>
                        <a id='filePicker' (click)='dishImage.click()' mat-fab>
                            <mat-icon>add</mat-icon>
                        </a>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-container">
                            
                                <div class='form-elements'>
                                    <mat-form-field appearance="standard">
                                        <mat-label>Dish name</mat-label>
                                        <input formControlName='dishName' required matInput placeholder="Name for your dish">
                                        <mat-error *ngIf="dishName.invalid && dishName.touched && dishName.errors?.containsRestricted">
                                            Your dish name contains invalid characters
                                        </mat-error>
                                        <mat-progress-bar *ngIf="dishName.pending" mode="indeterminate"></mat-progress-bar>
                                        <mat-error *ngIf="dishName.errors?.nameExists">A dish with this name already exists</mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="standard">
                                        <mat-label>Dish price</mat-label>
                                        <input required formControlName='dishPrice' type='number' matInput placeholder="Price for your dish">
                                        <mat-error *ngIf="dishPrice.touched && dishPrice.errors?.containsRestrictedNumber && dishPrice.invalid">
                                            Please enter a valid price
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput formControlName='dishVideoUrl' placeholder="Add a video link here" type="url">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <textarea required matInput formControlName='dishDescription' placeholder="Add a description for your dish here" type="text"></textarea>
                                    </mat-form-field>
                                    <mat-form-field>
                                        <mat-select required placeholder='Is your dish veg/non-veg?' formControlName='dishEssence'>
                                            <mat-option>--None--</mat-option>
                                            <mat-option value="veg">Veg</mat-option>
                                            <mat-option value="nonveg">Non-Veg</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <mat-form-field>
                                        <mat-select required placeholder='Select a category for your dish' formControlName='dishCategory'>
                                            <mat-option>--None--</mat-option>
                                            <mat-option *ngFor="let category of categories$ | async" [value]="category">{{category.name}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <mat-form-field  *ngIf="showIngredients" >
                                        <mat-select
                                        required
                                        formControlName='dishIngredients'                            
                                        placeholder='Ingredients'
                                        multiple>
        
                                        <mat-option>--None--</mat-option>
                                        <mat-option *ngFor="let ingredient of ingredients$" [value]='ingredient' >
                                            {{ingredient.name}}
                                        </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <button color='primary' [disabled]='!dishForm.valid' type="submit" mat-raised-button>Create dish</button>
                                </div>

                            
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </mat-tab>
</mat-tab-group>